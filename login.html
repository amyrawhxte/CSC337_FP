<!--
Description: 
    - login form (username/email + password)
    - send POST to /login
    - On success -> redirect to home.html
    - Else, display error message with timer to make it disappear
-->

<!DOCTYPE html>
<html>
    <head>
        <link rel="stylesheet" href="style.css">
        <script>
            async function handleLogin(event) {
                event.preventDefault();

                const username = document.getElementById("username").value.trim()
                const email = document.getElementById("email").value.trim()
                const password = document.getElementById("password").value.trim()

                const body = {username, email, password}

                try {
                    const res = await fetch("/login", {
                        method: "POST",
                        headers: {"Content-Type": "application/json"},
                        body: JSON.stringify(body)
                    })

                    const data = await res.json(); 

                    if (!res.ok) {
                        showError(data.error || "Login failed");
                        return; 
                    }

                    localStorage.setItem("authToken", data.token)

                    window.location.href = "/profile"
                } catch (err) {
                    showError("Network error")
                }
            }

            function showError(msg) {
                const err = document.getElementById("errMsg");
                err.textContent = msg;

                setTimeout(() => {
                    err.textContent = "";
                }, 3000);
            }
        </script>

        <!--We can put this in a separate file to make it look cleaner-->
        <style>
        </style>
    </head>
    <body>
        <div class = "topBar">
            <h1>Login Page</h1>

            <a href="/home">Home</a>
            <a href="/register">Register</a>
            <a href="/profile">Profile</a>
            <a href="/products">Products</a>
            <a href="/cart">Cart</a>
        </div>

        <p>Description/Instructions for login</p>
        <form method="POST" action="/login" onsubmit="handleLogin(event)">
            <!--I firgured we could allow one or the other and simply
            check if one or the other was provided and if both that the two conincide.
            
            Or we can allow either input in one test box and validate an email or username-->
            <label>Username: </label>
            <input type="text" id="username" name="username">
            <br>

            <label>Email: </label>
            <input type="email" id="email" name="email">
            <br>

            <label>Password: </label>
            <input required type="password" id="password" name="password">
            <br>

            <button type="submit">Login</button>
        </form>

        <p id="errMsg"></p>
    </body>
</html>